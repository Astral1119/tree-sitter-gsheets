=map(search_key,lambda(j,
    if(j="",,sortn(
        result_range,1,,
        iferror(map(if(n(lookup_range)^0,j),lookup_range,
            lambda(h,i,lambda(f,
                f(f,h,i,1,floor(max(len(h),len(i))/2)-1)
            )(lambda(f,x,y,n,z,
                if(
                    n>len(x),
                    lambda(g,
                        average(
                            g/len(h),
                            g/len(i),
                            (g-index(reduce(
                                {1,0},
                                sequence(len(h)),
                                lambda(a,c,
                                    if(
                                        --mid(x,c,1),
                                        {find(1,y,index(a,1))+1,index(a,2)}+
                                        if(mid(h,c,1)=mid(i,find(1,y,index(a,1)),1),0,{0,1}),
                                        a
                                    )
                                )
                            ),2)/2)/g
                        )
                    )(sum(--mid(x,sequence(len(h)),1))),
                    lambda(a,
                        if(
                            iserr(a),
                            f(f,substitute(x,mid(x,n,1),0,1),y,n+1,z),
                            f(f,substitute(x,mid(x,n,1),1,1),left(y,a-1)&1&mid(y,a+1,9^9),n+1,z)
                        )
                    )(find(mid(x,n,1),left(y,n+z),max(1,n-z)))
                )
            )))
        )),
    ))
))
